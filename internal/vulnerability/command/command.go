package command

import (
	"fmt"

	alpha "github.com/nais/cli/internal/alpha/command/flag"
	"github.com/nais/cli/internal/vulnerability"
	"github.com/nais/cli/internal/vulnerability/command/flag"
	"github.com/nais/naistrix"
)

func Vulnerability(parentFlags *alpha.Alpha) *naistrix.Command {
	flags := &flag.Vulnerability{Alpha: parentFlags}
	return &naistrix.Command{
		Name:        "vulnerability",
		Aliases:     []string{"vuln"},
		Title:       "Interact with vulnerabilities.",
		StickyFlags: flags,
		SubCommands: []*naistrix.Command{
			find(flags),
		},
	}
}

var defaultArgs = []naistrix.Argument{
	{Name: "cve-id"},
}

func validateArgs(args *naistrix.Arguments) error {
	if args.Len() != 1 {
		return fmt.Errorf("expected 1 argument, got %d", args.Len())
	}
	if args.Get("cve-id") == "" {
		return fmt.Errorf("name cannot be empty")
	}
	return nil
}

func metadataFromArgs(args *naistrix.Arguments) vulnerability.Metadata {
	return vulnerability.Metadata{
		CveId: args.Get("cve-id"),
	}
}
